{"version":3,"sources":["../../src/routes/routes.js"],"sourcesContent":["module.exports = (app, passport, UserModel) => {\n\n  // Home Page\n  app.get(\"/\", (req, res) => res.render(\"home\", {\n    isAuth: req.isAuthenticated(),\n    user: req.user\n  }))\n  // Home Page\n  app.get(\"/privacy\", (req, res) => res.redirect(process.env.PRIVACY_URL))\n  \n  app.get(\"/termsofservice\", (req, res) => res.redirect(process.env.TOS_URL))\n\n  // Login\n  app.get(\"/login\", (req, res) => res.render(\"login\", {\n    message: req.flash(\"loginMessage\"),\n    isAuth: req.isAuthenticated(),\n    user: req.user\n  }))\n\n  app.post(\"/login\", passport.authenticate(\"local-login\", {\n    successRedirect: \"/profile\", // redirect to the secure profile section\n    failureRedirect: \"/login\", // redirect back to the signup page if there is an error\n    failureFlash: true // allow flash messages\n  }))\n\n  // Signup\n  app.get(\"/signup\", (req, res) => res.render(\"signup\", {\n    isAuth: req.isAuthenticated(),\n    user: req.user\n  }))\n\n  app.post(\"/signup\", passport.authenticate(\"local-signup\", {\n    successRedirect: \"/profile\",\n    failureRedirect: \"/signup\"\n  }))\n\n  // Profile\n  app.get(\"/profile\", isLoggedIn, (req, res) => {\n    let redirectUrl = `/user/${req.user.username}`\n    res.redirect(redirectUrl)\n  })\n\n  app.get(\"/user/:username\", (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.render(\"404\", {\n        isAuth: req.isAuthenticated(),\n        user: req.user,\n        profile: null,\n      })\n    }\n    let username = req.params.username\n    UserModel.findOne({\n      username\n    }, (err, doc) => {\n      if (err) throw err\n      if (!doc)\n        res.render(\"404\", {\n          isAuth: req.isAuthenticated(),\n          user: req.user,\n          profile: null,\n        })\n      else {\n        console.log(doc)\n        res.render(\"profile\", {\n          isAuth: req.isAuthenticated(),\n          user: req.user,\n          profile: doc,\n          isRoot: req.isAuthenticated() ? doc.username === req.user.username : false\n        })\n      }\n    })\n  })\n\n  app.get(\"/user/:username/edit\", (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.render(\"404\", {\n        isAuth: req.isAuthenticated(),\n        user: req.user,\n        profile: null,\n      })\n    }\n\n    \n\n    let username = req.params.username\n    UserModel.findOne({\n      username\n    }, (err, doc) => {\n      if (err) throw err\n      if (!doc)\n        res.render(\"404\", {\n          isAuth: req.isAuthenticated(),\n          user: req.user,\n          profile: null,\n        })\n      else {\n        if (!(req.user.flags.includes(\"sudo\") || req.user.username == doc.username)) {\n          return res.render(\"404\", {\n            isAuth: req.isAuthenticated(),\n            user: req.user,\n            profile: null,\n          })\n        }\n        console.log(doc)\n        res.render(\"user/edit\", {\n          isAuth: req.isAuthenticated(),\n          user: req.user,\n          profile: doc,\n          isRoot: req.user.flags.includes(\"sudo\")\n        })\n      }\n    })\n  })\n\n  app.get(\"/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\"/\")\n    })\n  })\n\n  app.get(\"/check-username-availability\", (req, res) => {\n    UserModel.find((err, users) => {\n      if (err) throw err\n      let usernames = users.map(val => val.username)\n      res.json(usernames)\n    })\n  })\n\n  // About Page\n  app.get(\"/about\", (req, res) => {\n    res.render(\"about\", {\n      isAuth: req.isAuthenticated(),\n      user: req.user,\n    })\n  })\n\n  require(\"./roblox\")(app, passport, UserModel)\n\n  app.use(\"/gloc/\", require(\"./gloc\"))\n\n  app.get(\"*\", (req, res) => {\n    res.render(\"404\", {\n      isAuth: req.isAuthenticated(),\n      user: req.user,\n    })\n  })\n}\n\nfunction isLoggedIn(req, res, next) {\n  // if user is authenticated in the session, carry on \n  if (req.isAuthenticated())\n    return next()\n  // if they aren't redirect them to the home page\n  res.redirect(\"/\")\n}"],"names":["module","exports","app","passport","UserModel","get","req","res","render","isAuth","isAuthenticated","user","redirect","process","env","PRIVACY_URL","TOS_URL","message","flash","post","authenticate","successRedirect","failureRedirect","failureFlash","isLoggedIn","redirectUrl","username","profile","params","findOne","err","doc","console","log","isRoot","flags","includes","logout","find","users","usernames","map","val","json","require","use","next"],"mappings":"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"}