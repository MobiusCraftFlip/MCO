{"version":3,"sources":["../../src/routes/gloc.js"],"sourcesContent":["const { Mongoose } = require(\"mongoose\")\nconst { createConnection, MongoClient, ServerApiVersion } = require(\"mongodb\")\nconst { Router } = require(\"express\")\nconst { getUsernameFromId } = require(\"noblox.js\")\n\nconst uri = process.env.MOKORE_URI\nconst client = new MongoClient(uri,  {\n  serverApi: {\n    version: ServerApiVersion.v1,\n    strict: true,\n    deprecationErrors: true,\n  }\n})\n\nconst Client = async () => {\n  if (client.isConnected()) {\n    return client\n  } else {\n    return await client.connect()\n  }\n}\n\nconst router = Router()\n\nrouter.get(\"/warnings\", async (req, res) => {\n  if (!req.isAuthenticated()) {\n    return res.render(\"404\", {\n      isAuth: req.isAuthenticated(),\n      user: req.user,\n      profile: null,\n    })\n  }\n  if (req.user && req.user.flags && req.user.flags.includes(\"glocadmin\")) {\n    const warnings = await (await Client()).db(\"test\").collection(\"warning_entity\").find().sort({_id: -1}).limit(50).toArray()\n    const names = []\n    warnings.forEach((value, index) => {\n      names[index] = getUsernameFromId(value.userid)\n    })\n    let realNames\n    try {\n      realNames = await Promise.all(names)\n            \n    } catch (error) {\n      try {\n        realNames = await Promise.all(names)\n                \n      } catch (error) {\n        res.send(500)\n      }\n    }\n    realNames.forEach((name, index) => {\n      warnings[index].name = name\n    })\n    return res.render(\"gloc/warnings\", {\n      isAuth: req.isAuthenticated(),\n      user: req.user,\n      profile: null,\n      warnings: warnings,\n    })\n  } else {\n    return res.render(\"404\", {\n      isAuth: req.isAuthenticated(),\n      user: req.user,\n      profile: null,\n    })\n  }\n})\n\nrouter.get(\"/players/:player\", async (req, res) => {\n  if (!req.isAuthenticated()) {\n    return res.render(\"404\", {\n      isAuth: req.isAuthenticated(),\n      user: req.user,\n      profile: null,\n    })\n  }\n    \n  if (req.user && req.user.flags && req.user.flags.includes(\"glocadmin\")) {\n        \n    const warnings = await (await Client()).db(\"test\").collection(\"warning_entity\").find({userid: req.params.player}).sort().toArray()\n        \n    const names = []\n    warnings.forEach((value, index) => {\n      names[index] = getUsernameFromId(value.userid)\n    })\n\n    const realNames = await Promise.all(names)\n    realNames.forEach((name, index) => {\n      warnings[index].name = name\n    })\n    return res.render(\"gloc/player\", {\n      isAuth: req.isAuthenticated(),\n      user: req.user,\n      profile: null,\n      warnings: warnings,\n    })\n  } else {\n    return res.render(\"404\", {\n      isAuth: req.isAuthenticated(),\n      user: req.user,\n      profile: null,\n    })\n  }\n})\n\nmodule.exports = router"],"names":["Mongoose","require","createConnection","MongoClient","ServerApiVersion","Router","getUsernameFromId","uri","process","env","MOKORE_URI","client","serverApi","version","v1","strict","deprecationErrors","Client","isConnected","connect","router","get","req","res","isAuthenticated","render","isAuth","user","profile","flags","includes","warnings","db","collection","find","sort","_id","limit","toArray","names","forEach","value","index","userid","realNames","Promise","all","error","send","name","params","player","module","exports"],"mappings":"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"}