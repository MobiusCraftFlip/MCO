{"version":3,"sources":["../../src/models/user.model.ts"],"sourcesContent":["import mongoose, { Schema, Types } from \"mongoose\"\nimport bcrypt from \"bcrypt\"\nimport {render} from \"ejs\"\n\nexport interface IUserSchema {\n  name: string,\n  username: string,\n  email: string,\n  password: string,\n  description: string,\n\n  roblox_id: string,\n  roblox_username: string,\n  roblox_displayname: string,\n\n\n  discord_id: string,\n  discord_username: string,\n  discord_displayname: string,\n\n  disabled: boolean,\n  disabledReason: string,\n\n  flags: string[],\n}\n\nlet userSchema = new Schema<IUserSchema>({\n  name: String,\n  username: String,\n  description: String,\n  email: String,\n  password: String,\n\n  roblox_id: String,\n  roblox_username: String,\n  roblox_displayname: String,\n\n\n  discord_id: String,\n  discord_username: String,\n  discord_displayname: String,\n\n  disabled: Boolean,\n  disabledReason: String,\n\n  flags: [String],\n})\n\n// Methods\nuserSchema.methods.generateHash = (password: string) => bcrypt.hashSync(password, 10)\n\nuserSchema.methods.validatePassword = function (password: string) {\n  return bcrypt.compareSync(password, this.password)\n}\n\n\n// const textInput = (name: string, value?: string) => `<b>${\"\"}</b><input class=\"input\" type=\"text\" name=${name} value=\"${value ? value :  \"\"}\"></input>`\nconst textInput = (name: string, value?: string) => render(`<b>${visableNames[name]}</b><input class=\"input\" type=\"text\" name=\"<%= name %>\" value=\"<%= value ? value :  ''%>\"></input>`, {name,value})\n\nexport const user_editable = {\n  description: (u) => textInput(\"description\", u.description)\n} as {[key: string]: (u: IUserSchema) => string}\n\nexport const user_viewable = {\n  email: \"Email\",\n  roblox_id: \"\"\n}\n\nexport const sudo_editable = {\n  description: (u) => textInput(\"description\", u.description),\n  email: (u) => textInput(\"email\", u.email),\n  roblox_id: (u) => textInput(\"roblox_id\", u.roblox_id),\n  roblox_username: (u) => textInput(\"roblox_username\", u.roblox_username),\n  roblox_displayname: (u) => textInput(\"roblox_displayname\", u.roblox_displayname),\n  discord_id: (u) => textInput(\"discord_id\", u.discord_id),\n  discord_username: (u) => textInput(\"discord_username\", u.discord_username),\n  discord_displayname: (u) => textInput(\"discord_displayname\", u.discord_displayname),\n  flags: () => \"\",\n} as {[key: string]: (u: IUserSchema) => string}\n\nexport const visableNames = {\n  name: \"Name\",\n  username: \"Username\",\n  description: \"Bio\",\n  email: \"Email\",\n  password: \"Password\",\n\n  roblox_id: \"Roblox UserID\",\n  roblox_username: \"Roblox Username\",\n  roblox_displayname: \"Roblox Displayname\",\n\n\n  discord_id: \"Discord Userid\",\n  discord_username: \"Discord Username\",\n  discord_displayname: \"Discord Displayname\",\n\n  flags: \"Flags\",\n} as  {[key: string]: string}\n\nfunction memorise<A,R>(func: (n: A) => Promise<R>)  {\n  const results : {[key:string]: R}= {};\n  return async (args: A) => {\n    const argsKey = JSON.stringify(args);\n    if (!results[argsKey]) {\n      results[argsKey] = await func(args);\n    }\n    return results[argsKey];\n  };\n};\n\nconst UserModel = mongoose.model(\"user\", userSchema)\n\nconst getUsernameFromId = memorise(async (id: string | Types.ObjectId) => {\n  return (await UserModel.findById(id).exec())?.username\n})\n\nexport {getUsernameFromId}\n\nexport default UserModel"],"names":["getUsernameFromId","sudo_editable","user_editable","user_viewable","visableNames","userSchema","Schema","name","String","username","description","email","password","roblox_id","roblox_username","roblox_displayname","discord_id","discord_username","discord_displayname","disabled","Boolean","disabledReason","flags","methods","generateHash","bcrypt","hashSync","validatePassword","compareSync","textInput","value","render","u","memorise","func","results","args","argsKey","JSON","stringify","UserModel","mongoose","model","id","findById","exec"],"mappings":";;;;;;;;;;;IAsHA,OAAwB;eAAxB;;IAFQA,iBAAiB;eAAjBA;;IAhDKC,aAAa;eAAbA;;IATAC,aAAa;eAAbA;;IAIAC,aAAa;eAAbA;;IAiBAC,YAAY;eAAZA;;;kEAhF2B;+DACrB;qBACE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwBrB,IAAIC,aAAa,IAAIC,gBAAM,CAAc;IACvCC,MAAMC;IACNC,UAAUD;IACVE,aAAaF;IACbG,OAAOH;IACPI,UAAUJ;IAEVK,WAAWL;IACXM,iBAAiBN;IACjBO,oBAAoBP;IAGpBQ,YAAYR;IACZS,kBAAkBT;IAClBU,qBAAqBV;IAErBW,UAAUC;IACVC,gBAAgBb;IAEhBc,OAAO;QAACd;KAAO;AACjB;AAEA,UAAU;AACVH,WAAWkB,OAAO,CAACC,YAAY,GAAG,CAACZ,WAAqBa,eAAM,CAACC,QAAQ,CAACd,UAAU;AAElFP,WAAWkB,OAAO,CAACI,gBAAgB,GAAG,SAAUf,QAAgB;IAC9D,OAAOa,eAAM,CAACG,WAAW,CAAChB,UAAU,IAAI,CAACA,QAAQ;AACnD;AAGA,0JAA0J;AAC1J,MAAMiB,YAAY,CAACtB,MAAcuB,QAAmBC,IAAAA,WAAM,EAAC,CAAC,GAAG,EAAE3B,YAAY,CAACG,KAAK,CAAC,kGAAkG,CAAC,EAAE;QAACA;QAAKuB;IAAK;AAE7L,MAAM5B,gBAAgB;IAC3BQ,aAAa,CAACsB,IAAMH,UAAU,eAAeG,EAAEtB,WAAW;AAC5D;AAEO,MAAMP,gBAAgB;IAC3BQ,OAAO;IACPE,WAAW;AACb;AAEO,MAAMZ,gBAAgB;IAC3BS,aAAa,CAACsB,IAAMH,UAAU,eAAeG,EAAEtB,WAAW;IAC1DC,OAAO,CAACqB,IAAMH,UAAU,SAASG,EAAErB,KAAK;IACxCE,WAAW,CAACmB,IAAMH,UAAU,aAAaG,EAAEnB,SAAS;IACpDC,iBAAiB,CAACkB,IAAMH,UAAU,mBAAmBG,EAAElB,eAAe;IACtEC,oBAAoB,CAACiB,IAAMH,UAAU,sBAAsBG,EAAEjB,kBAAkB;IAC/EC,YAAY,CAACgB,IAAMH,UAAU,cAAcG,EAAEhB,UAAU;IACvDC,kBAAkB,CAACe,IAAMH,UAAU,oBAAoBG,EAAEf,gBAAgB;IACzEC,qBAAqB,CAACc,IAAMH,UAAU,uBAAuBG,EAAEd,mBAAmB;IAClFI,OAAO,IAAM;AACf;AAEO,MAAMlB,eAAe;IAC1BG,MAAM;IACNE,UAAU;IACVC,aAAa;IACbC,OAAO;IACPC,UAAU;IAEVC,WAAW;IACXC,iBAAiB;IACjBC,oBAAoB;IAGpBC,YAAY;IACZC,kBAAkB;IAClBC,qBAAqB;IAErBI,OAAO;AACT;AAEA,SAASW,SAAcC,IAA0B;IAC/C,MAAMC,UAA6B,CAAC;IACpC,OAAO,OAAOC;QACZ,MAAMC,UAAUC,KAAKC,SAAS,CAACH;QAC/B,IAAI,CAACD,OAAO,CAACE,QAAQ,EAAE;YACrBF,OAAO,CAACE,QAAQ,GAAG,MAAMH,KAAKE;QAChC;QACA,OAAOD,OAAO,CAACE,QAAQ;IACzB;AACF;AAEA,MAAMG,YAAYC,iBAAQ,CAACC,KAAK,CAAC,QAAQrC;AAEzC,MAAML,oBAAoBiC,SAAS,OAAOU;IACxC,OAAQ,CAAA,MAAMH,UAAUI,QAAQ,CAACD,IAAIE,IAAI,EAAC,GAAIpC;AAChD;MAIA,WAAe+B"}