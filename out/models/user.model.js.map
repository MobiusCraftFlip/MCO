{"version":3,"sources":["../../src/models/user.model.ts"],"sourcesContent":["import mongoose, { ObjectId, Schema, Types } from \"mongoose\"\nimport bcrypt from \"bcrypt\"\nimport {render} from \"ejs\"\n\nexport interface IUserSchema {\n  _id: ObjectId\n  name: string,\n  username: string,\n  email: string,\n  password: string,\n  description: string,\n\n  roblox_id?: string,\n  roblox_username?: string,\n  roblox_displayname?: string,\n\n\n  discord_id?: string,\n  discord_username?: string,\n  discord_displayname?: string,\n\n  disabled?: boolean,\n  disabledType?: \"manual\",\n  disabledReason?: string,\n\n  sshKeys?: string[],\n  apiKey: string,\n\n  flags: string[],\n}\n\nexport interface IUserMethods {\n  generateHash: (password: string) => string\n  validatePassword: (password: string) => boolean\n}\n\nlet userSchema = new Schema<IUserSchema & IUserMethods>({\n  name: String,\n  username: String,\n  description: String,\n  email: String,\n  password: String,\n\n  roblox_id: String,\n  roblox_username: String,\n  roblox_displayname: String,\n\n\n  discord_id: String,\n  discord_username: String,\n  discord_displayname: String,\n\n  disabled: Boolean,\n  disabledType: String,\n  disabledReason: String,\n\n  sshKeys: [String],\n  apiKey: String,\n\n  flags: [String],\n})\n\n// Methods\nuserSchema.methods.generateHash = (password: string) => bcrypt.hashSync(password, 10)\n\nuserSchema.methods.validatePassword = function (password: string) {\n  return bcrypt.compareSync(password, this.password)\n}\n\n\n// const textInput = (name: string, value?: string) => `<b>${\"\"}</b><input class=\"input\" type=\"text\" name=${name} value=\"${value ? value :  \"\"}\"></input>`\nconst textInput = (name: string, value?: string) => render(`<b>${visableNames[name]}</b><input class=\"input\" type=\"text\" name=\"<%= name %>\" value=\"<%= value ? value :  ''%>\"></input>`, {name,value})\n\nexport const user_editable = {\n  description: (u) => textInput(\"description\", u.description)\n} as {[key: string]: (u: IUserSchema) => string}\n\nexport const user_viewable = {\n  email: \"Email\",\n  roblox_id: \"\"\n}\n\nexport const sudo_editable = {\n  description: (u) => textInput(\"description\", u.description),\n  email: (u) => textInput(\"email\", u.email),\n  roblox_id: (u) => textInput(\"roblox_id\", u.roblox_id),\n  roblox_username: (u) => textInput(\"roblox_username\", u.roblox_username),\n  roblox_displayname: (u) => textInput(\"roblox_displayname\", u.roblox_displayname),\n  discord_id: (u) => textInput(\"discord_id\", u.discord_id),\n  discord_username: (u) => textInput(\"discord_username\", u.discord_username),\n  discord_displayname: (u) => textInput(\"discord_displayname\", u.discord_displayname),\n  disabled: (u) => textInput(\"disabled\", u.disabled ? JSON.stringify(u.disabled) : \"false\"),\n  disabledType: (u) => textInput(\"disabledType\", u.disabledType ? u.disabledType : \"\"),\n  disabledReason: (u) => textInput(\"disabledReason\", u.disabledReason ? u.disabledReason : \"\"),\n  flags: () => \"\",\n} as {[key: string]: (u: IUserSchema) => string}\n\nexport const visableNames = {\n  name: \"Name\",\n  username: \"Username\",\n  description: \"Bio\",\n  email: \"Email\",\n  password: \"Password\",\n\n  roblox_id: \"Roblox UserID\",\n  roblox_username: \"Roblox Username\",\n  roblox_displayname: \"Roblox Displayname\",\n\n\n  discord_id: \"Discord Userid\",\n  discord_username: \"Discord Username\",\n  discord_displayname: \"Discord Displayname\",\n\n  \n  disabled: \"Disabled\",\n  disabledType: \"Disabled Type\",\n  disabledReason: \"Disabled Reason\",\n  apiKey: \"ApiKey\",\n  flags: \"Flags\",\n} as  {[key: string]: string}\n\nfunction memorise<A,R>(func: (n: A) => Promise<R>)  {\n  const results : {[key:string]: R}= {};\n  return async (args: A) => {\n    const argsKey = JSON.stringify(args);\n    if (!results[argsKey]) {\n      results[argsKey] = await func(args);\n    }\n    return results[argsKey];\n  };\n};\n\nuserSchema.pre(\"save\", () => {\n\n})\n\nconst UserModel = mongoose.model(\"user\", userSchema)\n\nconst getUsernameFromId = memorise(async (id: string | Types.ObjectId) => {\n  return (await UserModel.findById(id).exec())?.username\n})\n\nexport {getUsernameFromId}\n\nexport default UserModel"],"names":["getUsernameFromId","sudo_editable","user_editable","user_viewable","visableNames","userSchema","Schema","name","String","username","description","email","password","roblox_id","roblox_username","roblox_displayname","discord_id","discord_username","discord_displayname","disabled","Boolean","disabledType","disabledReason","sshKeys","apiKey","flags","methods","generateHash","bcrypt","hashSync","validatePassword","compareSync","textInput","value","render","u","JSON","stringify","memorise","func","results","args","argsKey","pre","UserModel","mongoose","model","id","findById","exec"],"mappings":"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"}